Trainerlist Server
------------------

This is a server written in node.js which is accessible through the REST protocol.

david-dm: [![](https://david-dm.org/furtal/trainerlist-server.png)](https://david-dm.org/furtal/trainerlist-server)

Setting up
==========

On a computer with nodejs and npm installed, just download the project, open a command line in its folder, and run

        npm install

Then start a couchDB server and run

        npm run-script syncdb

This creates the couchDB database if it does not exist, and also syncs the design documents.

To start the server, run

        npm start

While your couchDB server is up.

This creates a server listening on port 8080.


Automated tests
===============

To test, run

        npm test

or, install mocha...

        npm install mocha -g

and run it.
        
        mocha

On linux, you can run tests continuously with

        watch mocha


DB Maintenance
==============

Just start a couchDB server and run

        npm run-script syncdb

This runs syncdb.js, which will create the couchDB database if it does not exist, and update to the server the views this project depends upon.


Available Methods
=================

Here we look at all the methods available on the server.

On success, the response is always HTTP 200. If the response is not HTTP 200, there was an error.

In the future, when there is authentication support, HTTP 403 will indicate that the user was not authenticated correctly or that his session was expired for some reason. When this happens, redirect the user to a login prompt.

The HTTP verbs used are GET and POST.

 - GET is always used to retrieve data as a single object or a list of objects, with the guarantee that no changes will occur.
 - POST requests change the state of the information, by creating, deleting, or changing it.

Read more on each method available below.


### Trainer methods (the trainer is also the user for now)

A trainer object is comprised of the following keys:

 - `_id` (string): The unique id of the user. Generated by the server.
 - `_rev` (string): The current version of the object. Generated by server, and updated every time the object gets edited.
 - `email`: valid user e-mail
 - `username`: username for logging in. Only alphanumeric characters, numbers and `._-`.
 - `firstName`
 - `lastName`


#### Create trainer: `POST` to `/trainer`

Send a POST request to this URL to create a trainer. Send the following POST data:

 - email
 - username
 - firstName
 - lastName
 - password

On success, you get the trainer object as JSON in a HTTP 200 response.


#### Get trainer by ID: `GET` to `/trainer/<id>`

Use a HTTP GET request to retrieve the trainer by its ID.

The response is a trainer object in a 200 HTTP in case of no errors. 


#### Edit trainer information: `POST` to `/trainer/<id>`

HTTP POST to this URL (the same as to "Get trainer by ID") to edit the trainer.

Send the same keys as you would to create a trainer, except for the following ones.

 - password: this key may be left blank if the user does not want to change his password
 - rev: send this key to validate the version against the one existing in the database. This avoids concurrent editing issues.


#### Delete a trainer: `POST` to `/trainer/<id>/delete`

POST to the above URL to delete the trainer with the same ID.

Expect HTTP 200 to signal successful deletion.


### Trainee methods

Trainees come around in the next version.


### Authentication

#### Login a user: `POST` to `/authentication/login`

To login a user, POST to the above URL with the following keys:

 - login: the username or email of the user.
 - password

In this dummy server stage, you may only use `email@email.com` and `password` as credentials.


### Events

An event is an object comprised of the following keys:

 - `_id`
 - `_rev`
 - `timestamp` - an [ISO 8601 timestamp](http://en.wikipedia.org/wiki/ISO_8601)
 - `description` - A string (up to 40 characters) describing the event. Optional.

The following methods are available:


#### Get events of an user: `GET` to `/events/upcoming/<user id>`

GET to this url for a list of upcoming events. Use the following GET parameters:

 - `limit` - Number of days to look ahead. Default: 30
 - `start` - Start of data set. Default: 0


#### Get past events: `GET` to `/events/past/<user id>

GET to this url for a list of past events. Use the following GET parameters:

 - `limit` - Number of days to look behind. Default: 30
 - `start` - Start of data set. Default: 0


#### Create an event: `POST` to `/events/<user id>/create`

POST the following data to this URL to create an event

 - `timestamp`
 - `description`

These keys become keys of the event object you create. Read above.


#### Get an event: `GET` to `/events/<event id>`

GET to the above URL yields the event object. This is useful for providing an edit form for the user.


#### Edit an event: `POST` to `/events/<event id>/edit`

POST to the above URL to edit a given event. Remember to send all the keys present in the event, including `_rev`.

If `_rev` is outdated, you get an error, to avoid having multiple application instances editting the same event.


#### Delete an event: `POST` to `/events/<user id>/<event id>/delete`

If you POST to this URL, you delete the event. No POST data required.


